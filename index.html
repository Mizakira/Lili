<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Ventas y Presupuesto</title>
    <!-- Tailwind CSS CDN para estilos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilos generales para un fondo más profesional y pastel con un sutil degradado */
        .min-h-screen {
            background: linear-gradient(135deg, #f0f4f8, #e8f0f7); /* Degradado suave de gris azulado */
        }
        /* Contenedor principal más elegante */
        .main-container {
            background-color: #ffffff;
            border-radius: 1rem; /* Más redondeado */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); /* Sombra más suave y extendida */
            padding: 2.5rem; /* Más espacio interno */
        }

        /* Botones con estilo profesional */
        button {
            transition: all 0.2s ease-in-out;
            border-radius: 0.5rem; /* Menos redondeado para un look más serio */
            font-weight: 600; /* Semi-bold */
            letter-spacing: 0.03em; /* Ligero espaciado para mejor legibilidad */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); /* Sombra inicial sutil */
        }
        button:hover {
            transform: translateY(-4px); /* Efecto sutil de elevación al pasar el cursor */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); /* Sombra al hover más pronunciada pero suave */
        }

        /* Campos de entrada y selects más limpios */
        input[type="text"],
        input[type="number"],
        input[type="date"],
        select,
        textarea {
            border-radius: 1rem; /* Bordes muy suaves */
            border: 1px solid #d1dae8; /* Un tono de gris azulado muy claro para el borde */
            padding: 0.9rem 1.4rem; /* Relleno uniforme y generoso */
            font-size: 1.05rem; /* Tamaño de fuente ligeramente más grande */
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        input:focus, select:focus, textarea:focus {
            border-color: #93c5fd; /* Un tono de azul pastel brillante para el foco */
            box-shadow: 0 0 0 5px rgba(147, 197, 253, 0.35); /* Anillo de foco suave y más amplio */
            outline: none;
        }
        textarea {
            resize: vertical;
        }

        /* Estilos para el modal de confirmación, más suave y elevado */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7); /* Fondo más oscuro para el modal */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: #ffffff;
            padding: 3rem; /* Más padding */
            border-radius: 1rem;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            max-width: 500px; /* Más ancho */
            width: 90%;
            text-align: center;
        }
        .modal-content p {
            font-size: 1.15rem; /* Texto más grande en el modal */
            line-height: 1.6;
            color: #374151; /* Color de texto más definido */
        }

        /* Estilos específicos para los mensajes de notificación con pasteles más vibrantes */
        .message-box {
            position: fixed;
            top: 1.5rem; /* Un poco más abajo del borde */
            right: 1.5rem;
            padding: 0.8rem 1.5rem;
            border-radius: 0.75rem; /* Más redondeado */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            font-weight: 500; /* Medium weight */
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 999; /* Debajo del modal */
        }
        .message-box-close {
            background: none;
            border: none;
            font-size: 1.8rem; /* Tamaño de la 'x' */
            line-height: 1;
            padding: 0;
            margin-left: 1rem;
            cursor: pointer;
            color: inherit;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }
        .message-box-close:hover {
            opacity: 1;
        }

        /* Estilos para los títulos y texto */
        .main-heading {
            font-size: 3rem; /* Título principal más grande */
            font-weight: 800; /* Extra-bold */
            color: #2d3748; /* Un gris oscuro profundo */
            letter-spacing: -0.04em; /* Espaciado más sutil */
            line-height: 1.2;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.08); /* Sombra más pronunciada para profundidad */
            display: flex; /* Para alinear icono */
            align-items: center; /* Para alinear icono */
            justify-content: center; /* Centrar contenido horizontalmente */
        }
        .main-heading svg {
            margin-right: 1.5rem; /* Espacio entre icono y texto */
            stroke-width: 3.5; /* Grosor de línea para los iconos */
            color: #4a5568; /* Color para el icono del título principal */
        }
        .section-heading {
            font-size: 2.2rem; /* Títulos de sección grandes */
            font-weight: 700; /* Bold */
            color: #374151; /* Un gris azulado oscuro para los encabezados de sección */
            margin-bottom: 2rem; /* Más espacio inferior */
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e0e7ee; /* Línea más definida */
            display: flex; /* Para alinear icono */
            align-items: center; /* Para alinear icono */
        }
        .section-heading svg {
            margin-right: 1.2rem; /* Espacio entre icono y texto */
            stroke-width: 3; /* Grosor de línea para los iconos de sección */
        }
        .sub-heading {
            font-size: 1.6rem; /* Subtítulos de cards ligeramente más grandes */
            font-weight: 600; /* Semi-bold */
            color: #ffffff; /* Blanco para mejor contraste en tarjetas pastel */
            display: flex; /* Para alinear icono */
            align-items: center; /* Para alinear icono */
        }
        .sub-heading svg {
            margin-right: 1rem;
            stroke-width: 2.8; /* Grosor de línea para iconos de subtítulos */
        }
        .card-value {
            font-size: 3.5rem; /* Valores grandes en las cards */
            font-weight: 700;
            color: #ffffff;
        }
        .card-currency {
            font-size: 2.4rem; /* Tamaño de la moneda en las cards */
            font-weight: 600;
            color: #ffffff;
        }
        .card-secondary-value {
            font-size: 1.45rem; /* Valores secundarios en las cards */
            font-weight: 500;
            color: rgba(255, 255, 255, 0.95); /* Blanco casi opaco */
        }
        
        /* Ajustes para tablas con un look más suave y flotante */
        table {
            width: 100%;
            border-collapse: separate; /* Permite border-spacing */
            border-spacing: 0 0.75rem; /* Más espaciado entre filas para un look más ligero */
        }
        th, td {
            padding: 1.2rem 1.5rem; /* Más padding para celdas */
            text-align: left;
            border-bottom: none; /* Eliminar borde inferior de celdas para un look flotante */
        }
        thead th {
            background-color: #e6f0fa; /* Fondo muy claro azulado para encabezados */
            font-size: 0.9rem; /* Tamaño de fuente ligeramente más grande */
            font-weight: 700;
            color: #5a67d8; /* Un azul más vibrante para los encabezados */
            text-transform: uppercase;
            letter-spacing: 0.1em; /* Más espaciado entre letras */
            border-bottom: 2px solid #c3daee; /* Borde inferior para el thead */
            cursor: pointer; /* Indica que la columna es clicable */
            user-select: none; /* Evita selección de texto al hacer clic rápido */
        }
        thead th:hover {
            background-color: #dbe8f5; /* Fondo más oscuro al pasar el cursor */
        }
        tbody tr {
            background-color: #ffffff; /* Fondo blanco para las filas */
            border-radius: 1rem; /* Bordes redondeados para las filas */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.06); /* Sombra sutil para un efecto "flotante" */
            margin-bottom: 0.75rem; /* Asegurar espacio entre filas */
            transition: all 0.25s ease-in-out;
        }
        tbody tr:hover {
            background-color: #f7f9fc; /* Hover más claro y sutil */
            transform: translateY(-3px); /* Pequeña elevación al hover */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        tbody tr:last-child {
            margin-bottom: 0;
        }
        .overflow-x-auto {
            border-radius: 1.5rem; /* Redondeado para la tabla completa */
            border: none; /* Eliminar el borde principal de la tabla */
            padding: 0.5rem; /* Espaciado interno para la tabla */
        }

        /* Estilos específicos para los botones de modo de calculadora */
        .calculator-mode-button {
            border-radius: 0.75rem; /* Más redondeado para las pestañas */
            padding: 0.8rem 1.8rem; /* Relleno cómodo */
            font-weight: 700; /* Más audaz */
            font-size: 1.15rem; /* Tamaño de fuente más grande */
            letter-spacing: 0.02em; /* Espaciado sutil */
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08); /* Sombra para las pestañas */
            transition: all 0.25s ease-in-out;
        }
        .calculator-mode-button svg {
            stroke-width: 2.5;
            margin-right: 0.8rem;
        }
        .calculator-mode-button.active {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15); /* Sombra más fuerte para la activa */
            transform: translateY(-2px); /* Ligeramente levantada */
        }
        /* Estilos para la paginación */
        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 2rem;
            gap: 0.75rem;
        }
        .pagination-button {
            background-color: #e2e8f0;
            color: #4a5568;
            padding: 0.75rem 1.25rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        .pagination-button:hover:not(:disabled) {
            background-color: #cbd5e1;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .pagination-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .pagination-button.active {
            background-color: #4f46e5;
            color: white;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel CDN para transformar JSX a JavaScript en el navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Script de la aplicación React (Babel transpilado) -->
    <script type="text/babel">
        // Importa los hooks de React
        const { useState, useEffect, useCallback, useMemo } = React;

        // Componente para el modal de confirmación
        const ConfirmModal = ({ message, onConfirm, onCancel }) => {
            return (
                <div className="modal-overlay">
                    <div className="modal-content">
                        <p className="text-gray-700 mb-12">{message}</p>
                        <div className="flex justify-center space-x-8">
                            <button
                                onClick={onCancel}
                                className="px-9 py-4 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 focus:outline-none focus:ring-4 focus:ring-gray-300 focus:ring-opacity-50 text-xl font-medium"
                            >
                                Cancelar
                            </button>
                            <button
                                onClick={onConfirm}
                                className="px-9 py-4 bg-rose-400 text-white rounded-xl hover:bg-rose-500 focus:outline-none focus:ring-4 focus:ring-rose-300 focus:ring-opacity-50 text-xl font-medium"
                            >
                                Confirmar
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Componente para la caja de mensajes (notificaciones)
        const MessageBox = ({ message, type, onClose }) => {
            let bgColor = '';
            let textColor = '';
            switch (type) {
                case 'success':
                    bgColor = 'bg-emerald-200';
                    textColor = 'text-emerald-800';
                    break;
                case 'error':
                    bgColor = 'bg-rose-200';
                    textColor = 'text-rose-800';
                    break;
                case 'info':
                    bgColor = 'bg-blue-200';
                    textColor = 'text-blue-800';
                    break;
                case 'warning':
                    bgColor = 'bg-amber-200';
                    textColor = 'text-amber-800';
                    break;
                default:
                    bgColor = 'bg-gray-200';
                    textColor = 'text-gray-800';
            }

            return (
                <div className={`message-box ${bgColor} ${textColor}`}>
                    <span>{message}</span>
                    <button onClick={onClose} className="message-box-close">
                        &times;
                    </button>
                </div>
            );
        };


        // Constante para definir cuántos elementos por página
        const ITEMS_PER_PAGE = 10;

        // Componente React App completo
        const App = () => {
            // Estado para la tasa de cambio, cargada desde localStorage
            const [exchangeRate, setExchangeRate] = useState(() => {
                const savedRate = localStorage.getItem('exchangeRate');
                return savedRate ? parseFloat(savedRate) : 36.5; // Valor por defecto si no hay nada guardado
            });

            // Estados para ventas, cargados desde localStorage
            const [sales, setSales] = useState(() => {
                const savedSales = localStorage.getItem('sales');
                // Ensure backward compatibility if old sales data exists without 'items' array
                if (savedSales) {
                    const parsedSales = JSON.parse(savedSales);
                    return parsedSales.map(sale => {
                        // If sale doesn't have 'items' array, convert it to the new structure
                        if (!sale.items && sale.product && sale.quantity && sale.amount && sale.currency && sale.unitType) {
                            return {
                                ...sale,
                                items: [{
                                    product: sale.product,
                                    quantity: sale.quantity,
                                    amount: sale.amount,
                                    currency: sale.currency,
                                    unitType: sale.unitType
                                }]
                            };
                        }
                        // Ensure sale.items is always an array, even if it was stored as null/undefined
                        if (!sale.items) {
                            return { ...sale, items: [] };
                        }
                        return sale;
                    });
                }
                return [];
            });

            // Estados para gastos, cargados desde localStorage
            const [expenses, setExpenses] = useState(() => {
                const savedExpenses = localStorage.getItem('expenses');
                return savedExpenses ? JSON.parse(savedExpenses) : [];
            });
            
            // Estado para ventas de queso a crédito, cargados desde localStorage
            const [cheeseCreditSales, setCheeseCreditSales] = useState(() => {
                const savedCreditSales = localStorage.getItem('cheeseCreditSales');
                return savedCreditSales ? JSON.parse(savedCreditSales) : [];
            });

            // Estados del formulario de ventas para múltiples productos
            const [saleDate, setSaleDate] = useState('');
            const [saleItems, setSaleItems] = useState([{ product: '', quantity: '', amount: '', currency: 'USD', unitType: 'unidades' }]);
            const [salePaymentMethod, setSalePaymentMethod] = useState('');    
            const [saleOperationNumber, setSaleOperationNumber] = useState('');    
            // Nuevo estado para el tipo de venta (unidades o peso) - this now applies per item
            // Retaining saleTypeForSale to control the default type for new items
            const [saleTypeForSale, setSaleTypeForSale] = useState('unidades');

            // Estados del formulario de gastos
            const [expenseDate, setExpenseDate] = useState('');
            const [expenseCategory, setExpenseCategory] = useState('');
            const [expenseAmount, setExpenseAmount] = useState('');    
            const [expenseCurrency, setExpenseCurrency] = useState('USD');    
            // Removed expensePaymentMethod and expenseOperationNumber from state as they are not used in expense form

            // ESTADOS para la Calculadora de Precios de Venta por Unidad (General)
            const [calculatorMode, setCalculatorMode] = useState('calculateSellingPrice');    
            const [totalCostPrice, setTotalCostPrice] = useState('');    
            const [purchaseQuantity, setPurchaseQuantity] = useState('');    
            const [purchaseMeasurementUnit, setPurchaseMeasurementUnit] = useState('unidades');    
            const [profitPercentage, setProfitPercentage] = useState('');    
            
            const [desiredSellingPriceInput, setDesiredSellingPriceInput] = useState('');    
            const [desiredSellingPriceCurrency, setDesiredSellingPriceCurrency] = useState('USD');    
            
            const [calculatedCostPerUnit, setCalculatedCostPerUnit] = useState(null);    
            const [calculatedSellingPricePerUnit, setCalculatedSellingPricePerUnit] = useState(null);    
            const [calculatedProfitPercentageResult, setCalculatedProfitPercentageResult] = useState(null);    

            // Estado para la calculadora de Queso
            const [cheeseWeightGrams, setCheeseWeightGrams] = useState('');
            const [cheesePricePerKiloUSD, setCheesePricePerKiloUSD] = useState(''); // Precio por kilo para la calculadora de queso
            const [calculatedCheesePriceUSD, setCalculatedCheesePriceUSD] = useState(null);
            const [calculatedCheesePriceVES, setCalculatedCheesePriceVES] = useState(null);
            
            // Nuevos estados para el formulario de venta de queso a crédito
            const [creditCustomerName, setCreditCustomerName] = useState('');
            const [creditCheeseWeightGrams, setCreditCheeseWeightGrams] = useState('');

            // Estado para mensajes de usuario
            const [message, setMessage] = useState('');
            const [messageType, setMessageType] = useState('');    
            const [showMessageBox, setShowMessageBox] = useState(false);    

            // Nuevos estados para el modal de confirmación
            const [showConfirmModal, setShowConfirmModal] = useState(false);
            const [modalMessage, setModalMessage] = useState('');
            const [onConfirmAction, setOnConfirmAction] = useState(null);    

            // Estados de ordenación para ventas
            const [salesSortColumn, setSalesSortColumn] = useState('date');
            const [salesSortDirection, setSalesSortDirection] = useState('desc'); // 'asc' o 'desc'
            // Estados de paginación para ventas
            const [currentSalesPage, setCurrentSalesPage] = useState(1);

            // Estados de ordenación para gastos
            const [expensesSortColumn, setExpensesSortColumn] = useState('date');
            const [expensesSortDirection, setExpensesSortDirection] = useState('desc'); // 'asc' o 'desc'
            // Estados de paginación para gastos
            const [currentExpensesPage, setCurrentExpensesPage] = useState(1);

            // Estados de ordenación para ventas de queso a crédito
            const [cheeseCreditSortColumn, setCheeseCreditSortColumn] = useState('date');
            const [cheeseCreditSortDirection, setCheeseCreditSortDirection] = useState('desc');
            // Estados de paginación para ventas de queso a crédito
            const [currentCheeseCreditPage, setCurrentCheeseCreditPage] = useState(1);


            // Muestra mensajes temporales al usuario
            const showMessage = (msg, type) => {
                setMessage(msg);
                setMessageType(type);
                setShowMessageBox(true);    
                setTimeout(() => {
                    setShowMessageBox(false);    
                    setMessage('');    
                    setMessageType('');
                }, 5000);    
            };

            // Función para cerrar el mensaje manualmente
            const closeMessage = () => {
                setShowMessageBox(false);
                setMessage('');
                setMessageType('');
            };

            // Función para abrir el modal de confirmación
            const openConfirmModal = (message, callback) => {
                setModalMessage(message);
                setOnConfirmAction(() => callback);    
                setShowConfirmModal(true);
            };

            // Manejador para confirmar la acción en el modal
            const handleConfirm = () => {
                if (onConfirmAction) {
                    onConfirmAction();    
                }
                setShowConfirmModal(false);    
                setOnConfirmAction(null);    
            };

            // Manejador para cancelar la acción en el modal
            const handleCancel = () => {
                setShowConfirmModal(false);    
                setOnConfirmAction(null);    
            };

            // Guarda la tasa de cambio en localStorage cada vez que cambia
            useEffect(() => {
                localStorage.setItem('exchangeRate', exchangeRate.toString());
            }, [exchangeRate]);

            // Guarda las ventas en localStorage cada vez que cambian
            useEffect(() => {
                localStorage.setItem('sales', JSON.stringify(sales));
            }, [sales]);

            // Guarda los gastos en localStorage cada vez que cambian
            useEffect(() => {
                localStorage.setItem('expenses', JSON.stringify(expenses));
            }, [expenses]);

            // Guarda las ventas de queso a crédito en localStorage cada vez que cambian
            useEffect(() => {
                localStorage.setItem('cheeseCreditSales', JSON.stringify(cheeseCreditSales));
            }, [cheeseCreditSales]);


            // Manejador para añadir un nuevo producto a la lista de venta actual
            const handleAddSaleItem = () => {
                setSaleItems([...saleItems, { product: '', quantity: '', amount: '', currency: 'USD', unitType: saleTypeForSale }]);
            };

            // Manejador para eliminar un producto de la lista de venta actual
            const handleRemoveSaleItem = (indexToRemove) => {
                setSaleItems(saleItems.filter((_, index) => index !== indexToRemove));
            };

            // Manejador para actualizar un campo de un producto específico en la lista de venta
            const handleSaleItemChange = (index, field, value) => {
                const updatedItems = saleItems.map((item, idx) => {
                    if (index === idx) {
                        // If changing unitType for a peso_g item, currency must be USD
                        if (field === 'unitType' && value === 'peso_g') {
                            return { ...item, [field]: value, currency: 'USD' };
                        }
                        return { ...item, [field]: value };
                    }
                    return item;
                });
                setSaleItems(updatedItems);
            };

            // Manejador para añadir una nueva venta
            const handleAddSale = (e) => {
                e.preventDefault();    

                // Validate overall sale properties first
                if (!saleDate) {
                    showMessage('La fecha de venta no puede estar vacía.', 'error');
                    return;
                }
                if (!salePaymentMethod) {
                    showMessage('Por favor, selecciona un método de pago para la venta.', 'error');
                    return;
                }
                if (salePaymentMethod === 'Pago Móvil' && !saleOperationNumber.trim()) {
                    showMessage('El número de operación es obligatorio para Pago Móvil.', 'error');
                    return;
                }
                
                if (saleItems.length === 0) {
                    showMessage('Debe agregar al menos un producto para registrar la venta.', 'error');
                    return;
                }

                // Validate each item in saleItems
                const validatedItems = [];
                for (const item of saleItems) {
                    if (!item.product.trim()) {
                        showMessage('El nombre de un producto no puede estar vacío.', 'error');
                        return;
                    }
                    if (!item.quantity) {
                        showMessage('La cantidad de un producto no puede estar vacía.', 'error');
                        return;
                    }
                    const parsedQuantity = parseFloat(item.quantity);
                    if (isNaN(parsedQuantity) || parsedQuantity <= 0) {
                        showMessage('La cantidad debe ser un número válido mayor que cero para todos los productos.', 'error');
                        return;
                    }

                    if (!item.amount) {
                        showMessage('El monto unitario de un producto no puede estar vacío.', 'error');
                        return;
                    }
                    const parsedAmount = parseFloat(item.amount);
                    if (isNaN(parsedAmount) || parsedAmount <= 0) {
                        showMessage('El monto unitario debe ser un número válido mayor que cero para todos los productos.', 'error');
                        return;
                    }

                    // Adjust product label if it's a 'peso' sale type
                    let storedProductLabel = item.product.trim();
                    let itemCurrency = item.currency;

                    if (item.unitType === 'peso_g') {
                        storedProductLabel = `${item.product.trim()} (Peso)`;
                        itemCurrency = 'USD'; // Price per kilo is always USD
                    }

                    validatedItems.push({
                        product: storedProductLabel,
                        quantity: parsedQuantity,
                        amount: parsedAmount,
                        currency: itemCurrency,
                        unitType: item.unitType
                    });
                }

                const newSale = {
                    id: Date.now(),    
                    date: saleDate,
                    paymentMethod: salePaymentMethod,    
                    operationNumber: salePaymentMethod === 'Pago Móvil' ? saleOperationNumber.trim() : '',    
                    items: validatedItems, // Store the array of validated items
                };
                
                setSales(prevSales => [...prevSales, newSale]);    
                showMessage('Venta agregada exitosamente.', 'success');
                setCurrentSalesPage(1); // Reset to first page after adding new sale

                // Clear form fields
                setSaleDate('');
                setSalePaymentMethod('');    
                setSaleOperationNumber('');    
                setSaleItems([{ product: '', quantity: '', amount: '', currency: 'USD', unitType: 'unidades' }]); // Reset to one empty item
                setSaleTypeForSale('unidades'); // Reset sale type radio to default
            };

            // Manejador para añadir un nuevo gasto
            const handleAddExpense = (e) => {
                e.preventDefault();    

                const expenseAmountVal = expenseAmount.trim();

                if (!expenseDate) {
                    showMessage('La fecha de gasto no puede estar vacía.', 'error');
                    return;
                }
                if (!expenseCategory.trim()) {
                    showMessage('La categoría de gasto no puede estar vacía.', 'error');
                    return;
                }
                if (!expenseAmountVal) {
                    showMessage('El monto de gasto no puede estar vacío.', 'error');
                    return;
                }
                const parsedExpenseAmount = parseFloat(expenseAmountVal);
                if (isNaN(parsedExpenseAmount) || parsedExpenseAmount <= 0) {
                    showMessage('El monto de gasto debe ser un número válido mayor que cero.', 'error');
                    return;
                }
                
                const newExpense = {
                    id: Date.now(),    
                    date: expenseDate,
                    category: expenseCategory.trim(),
                    amount: parsedExpenseAmount,
                    currency: expenseCurrency, 
                };
                
                setExpenses(prevExpenses => [...prevExpenses, newExpense]);    
                showMessage('Gasto agregado exitosamente.', 'success');
                setCurrentExpensesPage(1); // Reset to first page after adding new expense

                setExpenseDate('');
                setExpenseCategory('');
                setExpenseAmount('');
                setExpenseCurrency('USD');    
            };
            
            // Manejador para añadir una nueva venta de queso a crédito
            const handleAddCheeseCreditSale = (e) => {
                e.preventDefault();
                const parsedCreditCheeseWeightGrams = parseFloat(creditCheeseWeightGrams);
                const parsedCheesePricePerKiloUSD = parseFloat(cheesePricePerKiloUSD); // Usar el precio del kilo de queso de la calculadora

                if (!creditCustomerName.trim()) {
                    showMessage('El nombre del cliente no puede estar vacío.', 'error');
                    return;
                }
                if (isNaN(parsedCreditCheeseWeightGrams) || parsedCreditCheeseWeightGrams <= 0) {
                    showMessage('Por favor, ingresa un peso válido en gramos (número mayor que cero).', 'error');
                    return;
                }
                if (isNaN(parsedCheesePricePerKiloUSD) || parsedCheesePricePerKiloUSD <= 0) {
                    showMessage('Por favor, configura un precio válido por kilo en la "Calculadora de Venta de Queso por Peso" antes de registrar el crédito.', 'error');
                    return;
                }
                if (exchangeRate <= 0) {
                    showMessage('La tasa de cambio debe ser mayor que cero para calcular en VES.', 'error');
                    return;
                }

                const totalUSD = (parsedCreditCheeseWeightGrams / 1000) * parsedCheesePricePerKiloUSD;

                const newCreditSale = {
                    id: Date.now(),
                    date: new Date().toISOString().slice(0, 10), // Fecha actual
                    customerName: creditCustomerName.trim(),
                    weightGrams: parsedCreditCheeseWeightGrams,
                    pricePerKiloUSD: parsedCheesePricePerKiloUSD, // Guardar el precio por kilo usado en ese momento
                    totalUSD: totalUSD,
                };

                setCheeseCreditSales(prevSales => [...prevSales, newCreditSale]);
                showMessage('Venta de queso a crédito registrada.', 'success');
                setCurrentCheeseCreditPage(1); // Reset to first page after adding

                setCreditCustomerName('');
                setCreditCheeseWeightGrams('');
            };


            // Manejador para eliminar una venta individual
            const handleDeleteSale = (id) => {
                setSales(prevSales => prevSales.filter(sale => sale.id !== id));
                showMessage('Venta eliminada.', 'success');
                // Ajustar página si la última fila de la página actual fue eliminada
                if (currentSalesPage > 1 && paginatedSales.length === 1 && sales.length === ITEMS_PER_PAGE + 1) {
                    setCurrentSalesPage(prev => prev - 1);
                }
            };

            // Manejador para eliminar un gasto individual
            const handleDeleteExpense = (id) => {
                setExpenses(prevExpenses => prevExpenses.filter(expense => expense.id !== id));
                showMessage('Gasto eliminado.', 'success');
                // Ajustar página si la última fila de la página actual fue eliminada
                if (currentExpensesPage > 1 && paginatedExpenses.length === 1 && expenses.length === ITEMS_PER_PAGE + 1) {
                    setCurrentExpensesPage(prev => prev - 1);
                }
            };
            
            // Manejador para eliminar una venta de queso a crédito individual
            const handleDeleteCheeseCreditSale = (id) => {
                setCheeseCreditSales(prevSales => prevSales.filter(sale => sale.id !== id));
                showMessage('Venta a crédito de queso eliminada.', 'success');
                if (currentCheeseCreditPage > 1 && paginatedCheeseCreditSales.length === 1 && cheeseCreditSales.length === ITEMS_PER_PAGE + 1) {
                    setCurrentCheeseCreditPage(prev => prev - 1);
                }
            };


            // Manejador para borrar TODO el historial de ventas
            const handleClearSales = () => {
                openConfirmModal(
                    '¿Estás seguro de que quieres borrar TODO el historial de ventas? Esta acción no se puede deshacer.',
                    () => {
                        setSales([]);    
                        localStorage.removeItem('sales');    
                        showMessage('Historial de ventas borrado.', 'success');
                        setCurrentSalesPage(1); // Reset page after clearing
                    }
                );
            };

            // Manejador para borrar TODO el historial de gastos
            const handleClearExpenses = () => {
                openConfirmModal(
                    '¿Estás seguro de que quieres borrar TODO el historial de gastos? Esta acción no se puede deshacer.',
                    () => {
                        setExpenses([]);    
                        localStorage.removeItem('expenses');    
                        showMessage('Historial de gastos borrado.', 'success');
                        setCurrentExpensesPage(1); // Reset page after clearing
                    }
                );
            };
            
            // Manejador para borrar TODO el historial de ventas de queso a crédito
            const handleClearCheeseCreditSales = () => {
                openConfirmModal(
                    '¿Estás seguro de que quieres borrar TODO el historial de ventas de queso a crédito? Esta acción no se puede deshacer.',
                    () => {
                        setCheeseCreditSales([]);
                        localStorage.removeItem('cheeseCreditSales');
                        showMessage('Historial de ventas a crédito de queso borrado.', 'success');
                        setCurrentCheeseCreditPage(1); // Reset page after clearing
                    }
                );
            };


            // Manejador para calcular el precio de venta por unidad (general)
            const handleCalculateSellingPrice = (e) => {
                e.preventDefault();
                const parsedTotalCostPrice = parseFloat(totalCostPrice);
                const parsedPurchaseQuantity = parseFloat(purchaseQuantity);
                const parsedProfitPercentage = parseFloat(profitPercentage);

                if (isNaN(parsedTotalCostPrice) || parsedTotalCostPrice <= 0) {
                    showMessage('Por favor, ingresa un costo TOTAL válido (número mayor que cero).', 'error');
                    setCalculatedCostPerUnit(null);
                    setCalculatedSellingPricePerUnit(null);
                    setCalculatedProfitPercentageResult(null);    
                    return;
                }
                if (isNaN(parsedPurchaseQuantity) || parsedPurchaseQuantity <= 0) {
                    showMessage(`Por favor, ingresa una cantidad válida de ${purchaseMeasurementUnit} (número mayor que cero).`, 'error');
                    setCalculatedCostPerUnit(null);
                    setCalculatedSellingPricePerUnit(null);
                    setCalculatedProfitPercentageResult(null);    
                    return;
                }
                if (isNaN(parsedProfitPercentage) || parsedProfitPercentage < 0) {    
                    showMessage('Por favor, ingresa un porcentaje de ganancia válido (número mayor o igual a cero).', 'error');
                    setCalculatedCostPerUnit(null);
                    setCalculatedSellingPricePerUnit(null);
                    setCalculatedProfitPercentageResult(null);    
                    return;
                }

                const costPerUnit = parsedTotalCostPrice / parsedPurchaseQuantity;
                const sellingPricePerUnit = costPerUnit * (1 + parsedProfitPercentage / 100);
                
                setCalculatedCostPerUnit(costPerUnit);
                setCalculatedSellingPricePerUnit(sellingPricePerUnit);
                setCalculatedProfitPercentageResult(null);    
                showMessage('Precio de venta por unidad calculado.', 'success');

                // Clear form fields after calculation
                setTotalCostPrice('');
                setPurchaseQuantity('');
                setProfitPercentage('');
                setPurchaseMeasurementUnit('unidades');
            };

            // Manejador para calcular el porcentaje de ganancia (general)
            const handleCalculateProfitPercentage = (e) => {
                e.preventDefault();
                const parsedTotalCostPrice = parseFloat(totalCostPrice);
                const parsedPurchaseQuantity = parseFloat(purchaseQuantity);
                const desiredSellingPriceInputVal = desiredSellingPriceInput.trim();

                if (isNaN(parsedTotalCostPrice) || parsedTotalCostPrice <= 0) {
                    showMessage('Por favor, ingresa un costo TOTAL válido (número mayor que cero).', 'error');
                    setCalculatedCostPerUnit(null);
                    setCalculatedSellingPricePerUnit(null);
                    setCalculatedProfitPercentageResult(null);
                    return;
                }
                if (isNaN(parsedPurchaseQuantity) || parsedPurchaseQuantity <= 0) {
                    showMessage(`Por favor, ingresa una cantidad válida de ${purchaseMeasurementUnit} (número mayor que cero).`, 'error');
                    setCalculatedCostPerUnit(null);
                    setCalculatedSellingPricePerUnit(null);
                    setCalculatedProfitPercentageResult(null);
                    return;
                }
                if (!desiredSellingPriceInputVal) {
                    showMessage('Por favor, ingresa el precio de venta deseado por unidad.', 'error');
                    setCalculatedCostPerUnit(null);
                    setCalculatedSellingPricePerUnit(null);
                    setCalculatedProfitPercentageResult(null);
                    return;
                }
                const parsedDesiredSellingPrice = parseFloat(desiredSellingPriceInputVal);
                if (isNaN(parsedDesiredSellingPrice) || parsedDesiredSellingPrice <= 0) {
                    showMessage('El precio de venta deseado debe ser un número válido mayor que cero.', 'error');
                    setCalculatedCostPerUnit(null);
                    setCalculatedSellingPricePerUnit(null);
                    setCalculatedProfitPercentageResult(null);
                    return;
                }

                const costPerUnit = parsedTotalCostPrice / parsedPurchaseQuantity;
                let sellingPriceForCalculation = parsedDesiredSellingPrice;

                // Convertir el precio de venta deseado a USD si se ingresó en VES
                if (desiredSellingPriceCurrency === 'VES') {
                    if (exchangeRate <= 0) {
                        showMessage('La tasa de cambio debe ser mayor que cero para convertir de VES a USD.', 'error');
                        setCalculatedCostPerUnit(null);
                        setCalculatedSellingPricePerUnit(null);
                        setCalculatedProfitPercentageResult(null);
                        return;
                    }
                    sellingPriceForCalculation = parsedDesiredSellingPrice / exchangeRate;
                }

                if (costPerUnit === 0) {
                    showMessage('El costo por unidad no puede ser cero para calcular el porcentaje de ganancia.', 'error');
                    setCalculatedCostPerUnit(null);
                    setCalculatedSellingPricePerUnit(null);
                    setCalculatedProfitPercentageResult(null);
                    return;
                }

                const profitPercentageCalculated = ((sellingPriceForCalculation - costPerUnit) / costPerUnit) * 100;
                
                setCalculatedCostPerUnit(costPerUnit);
                setCalculatedSellingPricePerUnit(parsedDesiredSellingPrice); // Mostrar el precio deseado en su moneda original
                setCalculatedProfitPercentageResult(profitPercentageCalculated);
                showMessage('Porcentaje de ganancia calculado.', 'success');

                // Clear form fields after calculation
                setTotalCostPrice('');
                setPurchaseQuantity('');
                setDesiredSellingPriceInput('');
                setPurchaseMeasurementUnit('unidades');
                setDesiredSellingPriceCurrency('USD');
            };

            // Manejador para la calculadora de queso (manteniendo la que estaba)
            const handleCalculateCheesePrice = (e) => {
                e.preventDefault();
                const parsedCheeseWeightGrams = parseFloat(cheeseWeightGrams);
                const parsedCheesePricePerKiloUSD = parseFloat(cheesePricePerKiloUSD);

                if (isNaN(parsedCheeseWeightGrams) || parsedCheeseWeightGrams <= 0) {
                    showMessage('Por favor, ingresa un peso válido en gramos (número mayor que cero).', 'error');
                    setCalculatedCheesePriceUSD(null);
                    setCalculatedCheesePriceVES(null);
                    return;
                }
                if (isNaN(parsedCheesePricePerKiloUSD) || parsedCheesePricePerKiloUSD <= 0) {
                    showMessage('Por favor, ingresa un precio válido por kilo en USD (número mayor que cero).', 'error');
                    setCalculatedCheesePriceUSD(null);
                    setCalculatedCheesePriceVES(null);
                    return;
                }
                if (exchangeRate <= 0) {
                    showMessage('La tasa de cambio debe ser mayor que cero para calcular en VES.', 'error');
                    setCalculatedCheesePriceUSD(null);
                    setCalculatedCheesePriceVES(null);
                    return;
                }

                const totalUSD = (parsedCheeseWeightGrams / 1000) * parsedCheesePricePerKiloUSD;
                const totalVES = totalUSD * exchangeRate;

                setCalculatedCheesePriceUSD(totalUSD);
                setCalculatedCheesePriceVES(totalVES);
                showMessage('Precio del queso calculado.', 'success');
            };


            // Función de ayuda para convertir a USD
            const convertToUSD = useCallback((amount, currency) => {
                if (currency === 'VES') {
                    return exchangeRate > 0 ? amount / exchangeRate : 0;
                }
                return amount;
            }, [exchangeRate]);

            // Cálculos de totales y ganancia/pérdida
            const totalSalesUSD = sales.reduce((acc, sale) => {
                const saleTotalUSD = (sale.items || []).reduce((itemAcc, item) => { // Added defensive check
                    const effectiveAmount = item.unitType === 'peso_g' ? (item.quantity / 1000) * item.amount : item.quantity * item.amount;
                    return itemAcc + convertToUSD(effectiveAmount, item.currency);
                }, 0);
                return acc + saleTotalUSD;
            }, 0);
            const totalSalesVES = totalSalesUSD * exchangeRate; // Calcular VES a partir de USD total

            const totalExpensesUSD = expenses.reduce((acc, expense) => acc + convertToUSD(expense.amount, expense.currency), 0);    
            const totalExpensesVES = totalExpensesUSD * exchangeRate; // Calcular VES a partir de USD total
            
            const totalCheeseCreditSalesUSD = cheeseCreditSales.reduce((acc, sale) => acc + sale.totalUSD, 0);
            const totalCheeseCreditSalesVES = totalCheeseCreditSalesUSD * exchangeRate; // Calcular VES a partir de USD total del fiado


            const netProfitUSD = totalSalesUSD - totalExpensesUSD;
            const netProfitVES = netProfitUSD * exchangeRate;

            // Lógica de ordenación para ventas
            const handleSalesSort = (column) => {
                if (salesSortColumn === column) {
                    setSalesSortDirection(salesSortDirection === 'asc' ? 'desc' : 'asc');
                } else {
                    setSalesSortColumn(column);
                    setSalesSortDirection('asc');
                }
                setCurrentSalesPage(1); // Reset to first page on sort change
            };

            // Lógica de ordenación para gastos
            const handleExpensesSort = (column) => {
                if (expensesSortColumn === column) {
                    setExpensesSortDirection(expensesSortDirection === 'asc' ? 'desc' : 'asc');
                } else {
                    setExpensesSortColumn(column);
                    setExpensesSortDirection('asc');
                }
                setCurrentExpensesPage(1); // Reset to first page on sort change
            };
            
            // Lógica de ordenación para ventas de queso a crédito
            const handleCheeseCreditSort = (column) => {
                if (cheeseCreditSortColumn === column) {
                    setCheeseCreditSortDirection(cheeseCreditSortDirection === 'asc' ? 'desc' : 'asc');
                } else {
                    setCheeseCreditSortColumn(column);
                    setCheeseCreditSortDirection('asc');
                }
                setCurrentCheeseCreditPage(1); // Reset to first page on sort change
            };

            // Memoized sorted sales data (before pagination)
            const sortedSales = useMemo(() => {
                if (!sales || sales.length === 0) return [];
                const sortableSales = [...sales]; // Crear una copia para ordenar

                sortableSales.sort((a, b) => {
                    let aValue, bValue;

                    switch (salesSortColumn) {
                        case 'date':
                            aValue = new Date(a.date);
                            bValue = new Date(b.date);
                            break;
                        case 'product': // Corrected logic for sorting by product name
                            // Safely access the first item's product name, default to empty string if no items or product name
                            aValue = (a.items && (a.items || []).length > 0 && (a.items || [])[0].product) ? (a.items || [])[0].product.toLowerCase() : '';
                            bValue = (b.items && (b.items || []).length > 0 && (b.items || [])[0].product) ? (b.items || [])[0].product.toLowerCase() : '';
                            break;
                        case 'totalAmount':
                            // Calculate total amount for sale a
                            let aTotal = 0;
                            (a.items || []).forEach(item => { // Added defensive check
                                const effectiveAmount = item.unitType === 'peso_g' ? (item.quantity / 1000) * item.amount : item.quantity * item.amount;
                                aTotal += convertToUSD(effectiveAmount, item.currency);
                            });

                            // Calculate total amount for sale b
                            let bTotal = 0;
                            (b.items || []).forEach(item => { // Added defensive check
                                const effectiveAmount = item.unitType === 'peso_g' ? (b.quantity / 1000) * item.amount : b.quantity * item.amount;
                                bTotal += convertToUSD(effectiveAmount, item.currency);
                            });

                            aValue = aTotal;
                            bValue = bTotal;
                            break;
                        default:
                            return 0;
                    }

                    if (aValue < bValue) return salesSortDirection === 'asc' ? -1 : 1;
                    if (aValue > bValue) return salesSortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
                return sortableSales;
            }, [sales, salesSortColumn, salesSortDirection, convertToUSD]); // Dependencias

            // Paginación de ventas
            const totalSalesPages = Math.ceil(sortedSales.length / ITEMS_PER_PAGE);
            const paginatedSales = useMemo(() => {
                const startIndex = (currentSalesPage - 1) * ITEMS_PER_PAGE;
                const endIndex = startIndex + ITEMS_PER_PAGE;
                return sortedSales.slice(startIndex, endIndex);
            }, [sortedSales, currentSalesPage]);


            // Memoized sorted expenses data (before pagination)
            const sortedExpenses = useMemo(() => {
                if (!expenses || expenses.length === 0) return [];
                const sortableExpenses = [...expenses]; // Crear una copia para ordenar

                sortableExpenses.sort((a, b) => {
                    let aValue, bValue;

                    switch (expensesSortColumn) {
                        case 'date':
                            aValue = new Date(a.date);
                            bValue = new Date(b.date);
                            break;
                        case 'category':
                            aValue = a.category.toLowerCase();
                            bValue = b.category.toLowerCase();
                            break;
                        case 'amount':
                            aValue = parseFloat(convertToUSD(a.amount, a.currency));
                            bValue = parseFloat(convertToUSD(b.amount, b.currency));
                            break;
                        default:
                            return 0;
                    }

                    if (aValue < bValue) return expensesSortDirection === 'asc' ? -1 : 1;
                    if (aValue > bValue) return expensesSortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
                return sortableExpenses;
            }, [expenses, expensesSortColumn, expensesSortDirection, convertToUSD]); // Dependencias

            // Paginación de gastos
            const totalExpensesPages = Math.ceil(sortedExpenses.length / ITEMS_PER_PAGE);
            const paginatedExpenses = useMemo(() => {
                const startIndex = (currentExpensesPage - 1) * ITEMS_PER_PAGE;
                const endIndex = startIndex + ITEMS_PER_PAGE;
                return sortedExpenses.slice(startIndex, endIndex);
            }, [sortedExpenses, currentExpensesPage]);
            
            // Memoized sorted cheese credit sales data
            const sortedCheeseCreditSales = useMemo(() => {
                if (!cheeseCreditSales || cheeseCreditSales.length === 0) return [];
                const sortableCreditSales = [...cheeseCreditSales];

                sortableCreditSales.sort((a, b) => {
                    let aValue, bValue;

                    switch (cheeseCreditSortColumn) {
                        case 'date':
                            aValue = new Date(a.date);
                            bValue = new Date(b.date);
                            break;
                        case 'customerName':
                            aValue = a.customerName.toLowerCase();
                            bValue = b.customerName.toLowerCase();
                            break;
                        case 'totalUSD':
                            aValue = a.totalUSD;
                            bValue = b.totalUSD;
                            break;
                        default:
                            return 0;
                    }

                    if (aValue < bValue) return cheeseCreditSortDirection === 'asc' ? -1 : 1;
                    if (aValue > bValue) return cheeseCreditSortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
                return sortableCreditSales;
            }, [cheeseCreditSales, cheeseCreditSortColumn, cheeseCreditSortDirection]);

            // Paginación de ventas de queso a crédito
            const totalCheeseCreditPages = Math.ceil(sortedCheeseCreditSales.length / ITEMS_PER_PAGE);
            const paginatedCheeseCreditSales = useMemo(() => {
                const startIndex = (currentCheeseCreditPage - 1) * ITEMS_PER_PAGE;
                const endIndex = startIndex + ITEMS_PER_PAGE;
                return sortedCheeseCreditSales.slice(startIndex, endIndex);
            }, [sortedCheeseCreditSales, currentCheeseCreditPage]);


            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 sm:p-6 lg:p-8">
                    {/* Mensajes de notificación con botón de cierre */}
                    {showMessageBox && (
                        <MessageBox message={message} type={messageType} onClose={closeMessage} />
                    )}

                    {/* Modal de Confirmación */}
                    {showConfirmModal && (
                        <ConfirmModal
                            message={modalMessage}
                            onConfirm={handleConfirm}
                            onCancel={handleCancel}
                        />
                    )}

                    <div className="w-full max-w-6xl bg-white main-container mb-8">
                        <h1 className="main-heading text-center mb-14">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3.5" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-dollar-sign">
                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                            Gestor de Ventas y Presupuesto
                        </h1>

                        {/* Sección de Tasa de Cambio */}
                        <div className="mb-16 p-9 bg-blue-50 border border-blue-100 rounded-3xl shadow-lg">
                            <h2 className="section-heading">
                                <svg xmlns="http://www.w3.org/2000/svg" width="52" height="52" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-arrows-right-left text-blue-800">
                                    <path d="M8 3H18L22 7L18 11H8"></path>
                                    <path d="M16 21H6L2 17L6 13H16"></path>
                                </svg>
                                Tasa de Cambio (USD a VES)
                            </h2>
                            <div className="flex flex-col sm:flex-row items-center space-y-6 sm:space-y-0 sm:space-x-6">
                                <label htmlFor="exchangeRate" className="text-xl text-gray-700 font-medium">1 USD =</label>
                                <input
                                    type="number"
                                    id="exchangeRate"
                                    value={exchangeRate}
                                    onChange={(e) => setExchangeRate(parseFloat(e.target.value) || 0)}
                                    className="flex-grow max-w-xs px-6 py-3.5 border border-blue-200 rounded-xl focus:ring-blue-400 focus:border-blue-400 text-lg"
                                    placeholder="Ej: 36.5"
                                    step="0.01"
                                    min="0"
                                />
                                <span className="text-xl text-gray-700 font-medium">VES</span>
                            </div>
                            <p className="text-sm text-gray-700 mt-6 text-center">
                                Actualiza este valor diariamente con la tasa de cambio actual (ej. BCV).
                            </p>
                            <p className="text-base text-blue-800 mt-3 text-center font-semibold">
                                ✨ Tus datos (ventas, gastos y tasa) se guardan automáticamente en tu navegador.
                            </p>
                        </div>

                        {/* Resumen General */}
                        <div className="mb-16">
                            <h2 className="section-heading">
                                <svg xmlns="http://www.w3.org/2000/svg" width="52" height="52" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-pie-chart text-gray-600">
                                    <path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path>
                                    <path d="M22 12A10 10 0 0 0 12 2v10Z"></path>
                                </svg>
                                Resumen General
                            </h2>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-9">
                                {/* Total Ventas */}
                                <div className="bg-gradient-to-br from-emerald-300 to-emerald-500 text-white p-9 rounded-3xl shadow-2xl flex flex-col items-center justify-center transform hover:scale-105 transition duration-300">
                                    <h3 className="sub-heading mb-4">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.8" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-trending-up">
                                            <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
                                            <polyline points="16 7 22 7 22 13"></polyline>
                                        </svg>
                                        Total Ventas (USD)
                                    </h3>
                                    <p className="card-value">
                                        <span className="card-currency">$</span>{totalSalesUSD.toFixed(2)}
                                    </p>
                                    <p className="card-secondary-value mt-4">
                                        ≈ Bs. {(totalSalesUSD * exchangeRate).toFixed(2)} VES
                                    </p>
                                </div>
                                {/* Total Gastos */}
                                <div className="bg-gradient-to-br from-rose-300 to-rose-500 text-white p-9 rounded-3xl shadow-2xl flex flex-col items-center justify-center transform hover:scale-105 transition duration-300">
                                    <h3 className="sub-heading mb-4">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.8" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-trending-down">
                                            <polyline points="22 17 13.5 8.5 8.5 13.5 2 7"></polyline>
                                            <polyline points="16 17 22 17 22 11"></polyline>
                                        </svg>
                                        Total Gastos (USD)
                                    </h3>
                                    <p className="card-value">
                                        <span className="card-currency">$</span>{totalExpensesUSD.toFixed(2)}
                                    </p>
                                    <p className="card-secondary-value mt-4">
                                        ≈ Bs. {(totalExpensesUSD * exchangeRate).toFixed(2)} VES
                                    </p>
                                </div>
                                {/* Ganancia Neta */}
                                <div className="bg-gradient-to-br from-violet-400 to-indigo-600 text-white p-9 rounded-3xl shadow-2xl flex flex-col items-center justify-center transform hover:scale-105 transition duration-300">
                                    <h3 className="sub-heading mb-4">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.8" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-sack">
                                            <path d="M12 10h.01"></path>
                                            <path d="M17 10h.01"></path>
                                            <path d="M7 10h.01"></path>
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-8Z"></path>
                                            <path d="M18 8h-4"></path>
                                            <path d="M10 2v4"></path>
                                            <path d="M8 2h4"></path>
                                            <path d="M10 10v10"></path>
                                            <path d="M14 10v10"></path>
                                        </svg>
                                        Ganancia Neta (USD)
                                    </h3>
                                    <p className="card-value">
                                        <span className="card-currency">$</span>{netProfitUSD.toFixed(2)}
                                    </p>
                                    <p className="card-secondary-value mt-4">
                                        ≈ Bs. {(netProfitUSD * exchangeRate).toFixed(2)} VES
                                    </p>
                                </div>
                            </div>
                        </div>

                        {/* Formulario de Nueva Venta */}
                        <div className="mb-16 p-9 bg-white rounded-3xl shadow-2xl border border-gray-100">
                            <h2 className="section-heading">
                                <svg xmlns="http://www.w3.org/2000/svg" width="52" height="52" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-plus-circle text-blue-600">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="8" x2="12" y2="16"></line>
                                    <line x1="8" y1="12" x2="16" y2="12"></line>
                                </svg>
                                Registrar Nueva Venta
                            </h2>
                            <form onSubmit={handleAddSale} className="grid grid-cols-1 gap-8">
                                <div className="md:col-span-2">
                                    <label className="block text-gray-700 text-base font-bold mb-2">Tipo de Venta para nuevos productos:</label>
                                    <div className="flex space-x-4">
                                        <label className="inline-flex items-center">
                                            <input
                                                type="radio"
                                                className="form-radio text-blue-600"
                                                name="saleType"
                                                value="unidades"
                                                checked={saleTypeForSale === 'unidades'}
                                                onChange={() => setSaleTypeForSale('unidades')}
                                            />
                                            <span className="ml-2 text-gray-700 text-lg">Por Unidades</span>
                                        </label>
                                        <label className="inline-flex items-center">
                                            <input
                                                type="radio"
                                                className="form-radio text-blue-600"
                                                name="saleType"
                                                value="peso"
                                                checked={saleTypeForSale === 'peso'}
                                                onChange={() => setSaleTypeForSale('peso')}
                                            />
                                            <span className="ml-2 text-gray-700 text-lg">Por Peso (Gramos/Kilo)</span>
                                        </label>
                                    </div>
                                    <p className="text-sm text-gray-500 mt-2">Esta opción establece el tipo predeterminado para las nuevas líneas de productos.</p>
                                </div>

                                <div>
                                    <label htmlFor="saleDate" className="block text-gray-700 text-base font-bold mb-2">Fecha</label>
                                    <input
                                        type="date"
                                        id="saleDate"
                                        value={saleDate}
                                        onChange={(e) => setSaleDate(e.target.value)}
                                        className="w-full"
                                        required
                                    />
                                </div>
                                <div className="col-span-1">
                                    <label htmlFor="salePaymentMethod" className="block text-gray-700 text-base font-bold mb-2">Método de Pago</label>
                                    <select
                                        id="salePaymentMethod"
                                        value={salePaymentMethod}
                                        onChange={(e) => {
                                            setSalePaymentMethod(e.target.value);
                                            if (e.target.value !== 'Pago Móvil') {
                                                setSaleOperationNumber('');    
                                            }
                                        }}
                                        className="w-full"
                                        required
                                    >
                                        <option value="">Seleccione</option>
                                        <option value="Efectivo USD">Efectivo USD</option>
                                        <option value="Efectivo VES">Efectivo VES</option>
                                        <option value="Transferencia">Transferencia</option>
                                        <option value="Pago Móvil">Pago Móvil</option>
                                    </select>
                                </div>
                                {salePaymentMethod === 'Pago Móvil' && (
                                    <div className="col-span-1">
                                        <label htmlFor="saleOperationNumber" className="block text-gray-700 text-base font-bold mb-2">Número de Operación</label>
                                        <input
                                            type="text"
                                            id="saleOperationNumber"
                                            value={saleOperationNumber}
                                            onChange={(e) => setSaleOperationNumber(e.target.value)}
                                            className="w-full"
                                            placeholder="Número de operación (Pago Móvil)"
                                            required={salePaymentMethod === 'Pago Móvil'}
                                        />
                                    </div>
                                )}

                                {/* Dynamic product entry */}
                                <div className="md:col-span-2 mt-4 border p-4 rounded-xl bg-gray-50">
                                    <h3 className="text-lg font-bold text-gray-800 mb-4">Productos en esta Venta:</h3>
                                    {saleItems.map((item, index) => (
                                        <div key={index} className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-4 items-end p-3 border-b border-gray-200 last:mb-0 last:border-b-0">
                                            <div className="sm:col-span-2 lg:col-span-1">
                                                <label htmlFor={`product-${index}`} className="block text-gray-700 text-sm font-bold mb-1">Producto</label>
                                                <input
                                                    type="text"
                                                    id={`product-${index}`}
                                                    value={item.product}
                                                    onChange={(e) => handleSaleItemChange(index, 'product', e.target.value)}
                                                    className="w-full"
                                                    placeholder="Nombre del producto"
                                                    required
                                                />
                                            </div>
                                            <div>
                                                <label htmlFor={`quantity-${index}`} className="block text-gray-700 text-sm font-bold mb-1">
                                                    Cantidad {item.unitType === 'peso_g' ? '(Gramos)' : ''}
                                                </label>
                                                <input
                                                    type="number"
                                                    id={`quantity-${index}`}
                                                    value={item.quantity}
                                                    onChange={(e) => handleSaleItemChange(index, 'quantity', e.target.value)}
                                                    className="w-full"
                                                    placeholder={item.unitType === 'peso_g' ? "Peso en gramos" : "Cantidad"}
                                                    min="0.01"
                                                    step="0.01"
                                                    required
                                                />
                                            </div>
                                            <div className="flex items-end space-x-2">
                                                <div className="flex-grow">
                                                    <label htmlFor={`amount-${index}`} className="block text-gray-700 text-sm font-bold mb-1">
                                                        Monto {item.unitType === 'peso_g' ? '(USD/Kilo)' : '(Unitario)'}
                                                    </label>
                                                    <input
                                                        type="number"
                                                        id={`amount-${index}`}
                                                        value={item.amount}
                                                        onChange={(e) => handleSaleItemChange(index, 'amount', e.target.value)}
                                                        className="w-full"
                                                        placeholder={item.unitType === 'peso_g' ? "Precio/kilo (USD)" : "Monto unitario"}
                                                        min="0.01"
                                                        step="0.01"
                                                        required
                                                    />
                                                </div>
                                                <div className="flex-shrink-0">
                                                    <label htmlFor={`currency-${index}`} className="sr-only">Moneda</label>
                                                    <select
                                                        id={`currency-${index}`}
                                                        value={item.currency}
                                                        onChange={(e) => handleSaleItemChange(index, 'currency', e.target.value)}
                                                        className="w-full py-3.5"
                                                        // If unitType is 'peso_g', currency must be USD
                                                        disabled={item.unitType === 'peso_g'}
                                                    >
                                                        <option value="USD">USD</option>
                                                        <option value="VES">VES</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div>
                                                <label htmlFor={`unitType-${index}`} className="sr-only">Tipo de Unidad</label>
                                                <select
                                                    id={`unitType-${index}`}
                                                    value={item.unitType}
                                                    onChange={(e) => handleSaleItemChange(index, 'unitType', e.target.value)}
                                                    className="w-full py-3.5"
                                                >
                                                    <option value="unidades">Unidades</option>
                                                    <option value="peso_g">Gramos</option>
                                                </select>
                                            </div>
                                            {saleItems.length > 1 && (
                                                <button
                                                    type="button"
                                                    onClick={() => handleRemoveSaleItem(index)}
                                                    className="bg-rose-500 text-white py-3 px-4 rounded-xl hover:bg-rose-600 focus:outline-none focus:ring-4 focus:ring-rose-300 focus:ring-opacity-50 text-base"
                                                >
                                                    Eliminar Producto
                                                </button>
                                            )}
                                        </div>
                                    ))}
                                    <button
                                        type="button"
                                        onClick={handleAddSaleItem}
                                        className="mt-4 w-full bg-emerald-400 text-white py-3.5 px-8 rounded-xl hover:bg-emerald-500 focus:outline-none focus:ring-4 focus:ring-emerald-300 focus:ring-opacity-50 text-lg flex items-center justify-center"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-plus mr-2">
                                            <line x1="12" y1="5" x2="12" y2="19"></line>
                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                        </svg>
                                        Agregar Otro Producto
                                    </button>
                                </div>

                                <div className="md:col-span-2 mt-5">
                                    <button
                                        type="submit"
                                        className="w-full bg-blue-400 text-white py-4.5 px-8 rounded-xl hover:bg-blue-500 focus:outline-none focus:ring-4 focus:ring-blue-300 focus:ring-opacity-50 text-xl flex items-center justify-center"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-plus mr-3">
                                            <line x1="12" y1="5" x2="12" y2="19"></line>
                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                        </svg>
                                        Registrar Venta Completa
                                    </button>
                                </div>
                            </form>
                        </div>

                        {/* Historial de Ventas */}
                        <div className="mb-16 p-9 bg-white rounded-3xl shadow-2xl border border-gray-100">
                            <h2 className="section-heading">
                                <svg xmlns="http://www.w3.org/2000/svg" width="52" height="52" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-receipt text-gray-600">
                                    <path d="M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2h-2h-2h-2h-2h-2h-2H4Z"></path>
                                    <path d="M18 6H8"></path>
                                    <path d="M18 10H8"></path>
                                    <path d="M18 14H8"></path>
                                    <path d="M18 18H8"></path>
                                </svg>
                                Historial de Ventas
                            </h2>
                            {paginatedSales.length === 0 ? (
                                <p className="text-gray-600 text-center py-7 text-lg">No hay ventas registradas aún.</p>
                            ) : (
                                <>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full">
                                            <thead>
                                                <tr>
                                                    <th onClick={() => handleSalesSort('date')} className="px-6 py-4 text-left">
                                                        Fecha {salesSortColumn === 'date' && (salesSortDirection === 'asc' ? '↑' : '↓')}
                                                    </th>
                                                    <th className="px-6 py-4 text-left">Productos (Cant.)</th> {/* Combined Product and Quantity */}
                                                    <th onClick={() => handleSalesSort('totalAmount')} className="px-6 py-4 text-left">
                                                        Monto Total {salesSortColumn === 'totalAmount' && (salesSortDirection === 'asc' ? '↑' : '↓')}
                                                    </th>
                                                    <th className="px-6 py-4 text-left">Método Pago</th>
                                                    <th className="px-6 py-4 text-left">N° Operación</th>
                                                    <th className="px-6 py-4 text-left">Acciones</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {paginatedSales.map((sale) => (
                                                    <tr key={sale.id}>
                                                        <td className="px-6 py-5 whitespace-nowrap text-base text-gray-800">{sale.date}</td>
                                                        <td className="px-6 py-5 text-base text-gray-800">
                                                            {(sale.items || []).map((item, itemIndex) => (
                                                                <div key={itemIndex} className="mb-1 last:mb-0">
                                                                    {item.product} ({item.quantity} {item.unitType === 'peso_g' ? 'g' : ''})
                                                                </div>
                                                            ))}
                                                        </td>
                                                        <td className="px-6 py-5 text-base text-gray-800">
                                                            {/* Calculate total for this specific sale to display here */}
                                                            {(() => {
                                                                let currentSaleTotalUSD = 0;
                                                                (sale.items || []).forEach(item => { 
                                                                    const effectiveAmount = item.unitType === 'peso_g' ? (item.quantity / 1000) * item.amount : item.quantity * item.amount;
                                                                    currentSaleTotalUSD += convertToUSD(effectiveAmount, item.currency);
                                                                });
                                                                const currentSaleTotalVES = currentSaleTotalUSD * exchangeRate;

                                                                return (
                                                                    <>
                                                                        {(sale.items || []).map((item, itemIndex) => {
                                                                            const itemTotalValue = item.unitType === 'peso_g' ? (item.quantity / 1000) * item.amount : item.quantity * item.amount;
                                                                            const displayAmount = item.currency === 'USD' ? `$${itemTotalValue.toFixed(2)} USD` : `${itemTotalValue.toFixed(2)} ${item.currency}`;
                                                                            const convertedAmount = item.currency === 'USD' ? (itemTotalValue * exchangeRate) : (itemTotalValue / exchangeRate);
                                                                            const convertedCurrencyLabel = item.currency === 'USD' ? 'VES' : 'USD';
                                                                            return (
                                                                                <div key={itemIndex} className="mb-1 last:mb-0">
                                                                                    <span className="font-medium">{displayAmount}</span>
                                                                                    <span className="text-sm text-gray-500 block">
                                                                                        (≈ {convertedCurrencyLabel === 'USD' ? '$' : 'Bs. '}
                                                                                        {convertedAmount.toFixed(2)} {convertedCurrencyLabel})
                                                                                    </span>
                                                                                </div>
                                                                            );
                                                                        })}
                                                                        <div className="font-bold mt-2 pt-2 border-t border-gray-200">
                                                                            Total Venta: ${currentSaleTotalUSD.toFixed(2)} USD
                                                                            <span className="text-sm text-gray-500 block">
                                                                                (≈ Bs. {currentSaleTotalVES.toFixed(2)} VES)
                                                                            </span>
                                                                        </div>
                                                                    </>
                                                                );
                                                            })()}
                                                        </td>
                                                        <td className="px-6 py-5 whitespace-nowrap text-base text-gray-800">{sale.paymentMethod || 'N/A'}</td>
                                                        <td className="px-6 py-5 whitespace-nowrap text-base text-gray-800">{sale.operationNumber || '-'}</td>
                                                        <td className="px-6 py-5 whitespace-nowrap text-right text-base font-medium">
                                                            <button
                                                                onClick={() => openConfirmModal('¿Estás seguro de que quieres eliminar esta venta?', () => handleDeleteSale(sale.id))}
                                                                className="text-rose-600 hover:text-rose-800 ml-4 p-2"
                                                            >
                                                                Eliminar
                                                            </button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                    {sortedSales.length > ITEMS_PER_PAGE && ( // Solo muestra la paginación si hay más de una página
                                        <div className="pagination-container">
                                            <button
                                                onClick={() => setCurrentSalesPage(prev => Math.max(prev - 1, 1))}
                                                disabled={currentSalesPage === 1}
                                                className="pagination-button"
                                            >
                                                Anterior
                                            </button>
                                            {Array.from({ length: totalSalesPages }, (_, i) => i + 1).map(page => (
                                                <button
                                                    key={page}
                                                    onClick={() => setCurrentSalesPage(page)}
                                                    className={`pagination-button ${currentSalesPage === page ? 'active' : ''}`}
                                                >
                                                    {page}
                                                </button>
                                            ))}
                                            <button
                                                onClick={() => setCurrentSalesPage(prev => Math.min(prev + 1, totalSalesPages))}
                                                disabled={currentSalesPage === totalSalesPages}
                                                className="pagination-button"
                                            >
                                                Siguiente
                                            </button>
                                        </div>
                                    )}
                                </>
                            )}
                        </div>

                        {/* Formulario de Nuevo Gasto */}
                        <div className="mb-16 p-9 bg-white rounded-3xl shadow-2xl border border-gray-100">
                            <h2 className="section-heading">
                                <svg xmlns="http://www.w3.org/2000/svg" width="52" height="52" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-minus-circle text-rose-600">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="8" y1="12" x2="16" y2="12"></line>
                                </svg>
                                Registrar Nuevo Gasto
                            </h2>
                            <form onSubmit={handleAddExpense} className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div>
                                    <label htmlFor="expenseDate" className="block text-gray-700 text-base font-bold mb-2">Fecha</label>
                                    <input
                                        type="date"
                                        id="expenseDate"
                                        value={expenseDate}
                                        onChange={(e) => setExpenseDate(e.target.value)}
                                        className="w-full"
                                        required
                                    />
                                </div>
                                <div>
                                    <label htmlFor="expenseCategory" className="block text-gray-700 text-base font-bold mb-2">Categoría</label>
                                    <input
                                        type="text"
                                        id="expenseCategory"
                                        value={expenseCategory}
                                        onChange={(e) => setExpenseCategory(e.target.value)}
                                        className="w-full"
                                        placeholder="Ej: Alquiler, Transporte, Publicidad"
                                        required
                                    />
                                </div>
                                <div className="flex items-end space-x-4">
                                    <div className="flex-grow">
                                        <label htmlFor="expenseAmount" className="block text-gray-700 text-base font-bold mb-2">Monto</label>
                                        <input
                                            type="number"
                                            id="expenseAmount"
                                            value={expenseAmount}
                                            onChange={(e) => setExpenseAmount(e.target.value)}    
                                            className="w-full"
                                            placeholder="Monto del gasto"
                                            min="0.01"
                                            step="0.01"
                                            required
                                        />
                                    </div>
                                    <div className="flex-shrink-0">
                                        <label htmlFor="expenseCurrency" className="sr-only">Moneda</label>
                                        <select
                                            id="expenseCurrency"
                                            value={expenseCurrency}
                                            onChange={(e) => setExpenseCurrency(e.target.value)}
                                            className="w-full py-3.5"
                                        >
                                            <option value="USD">USD</option>
                                            <option value="VES">VES</option> {/* Added VES option */}
                                        </select>
                                    </div>
                                </div>
                                <div className="md:col-span-2 mt-5">
                                    <button
                                        type="submit"
                                        className="w-full bg-rose-400 text-white py-4.5 px-8 rounded-xl hover:bg-rose-500 focus:outline-none focus:ring-4 focus:ring-rose-300 focus:ring-opacity-50 text-xl flex items-center justify-center"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-minus mr-3">
                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                        </svg>
                                        Agregar Gasto
                                    </button>
                                </div>
                            </form>
                        </div>

                        {/* Historial de Gastos */}
                        <div className="mb-16 p-9 bg-white rounded-3xl shadow-2xl border border-gray-100">
                            <h2 className="section-heading">
                                <svg xmlns="http://www.w3.org/2000/svg" width="52" height="52" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-archive text-gray-600">
                                    <rect width="20" height="5" x="2" y="3" rx="1"></rect>
                                    <path d="M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8"></path>
                                    <path d="M10 12h4"></path>
                                </svg>
                                Historial de Gastos
                            </h2>
                            {paginatedExpenses.length === 0 ? (
                                <p className="text-gray-600 text-center py-7 text-lg">No hay gastos registrados aún.</p>
                            ) : (
                                <>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full">
                                            <thead>
                                                <tr>
                                                    <th onClick={() => handleExpensesSort('date')} className="px-6 py-4 text-left">
                                                        Fecha {expensesSortColumn === 'date' && (expensesSortDirection === 'asc' ? '↑' : '↓')}
                                                    </th>
                                                    <th onClick={() => handleExpensesSort('category')} className="px-6 py-4 text-left">
                                                        Categoría {expensesSortColumn === 'category' && (expensesSortDirection === 'asc' ? '↑' : '↓')}
                                                    </th>
                                                    <th onClick={() => handleExpensesSort('amount')} className="px-6 py-4 text-left">
                                                        Monto {expensesSortColumn === 'amount' && (expensesSortDirection === 'asc' ? '↑' : '↓')}
                                                    </th>
                                                    <th className="px-6 py-4 text-left">Acciones</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {paginatedExpenses.map((expense) => (
                                                    <tr key={expense.id}>
                                                        <td className="px-6 py-5 whitespace-nowrap text-base text-gray-800">{expense.date}</td>
                                                        <td className="px-6 py-5 whitespace-nowrap text-base text-gray-800">{expense.category}</td>
                                                        <td className="px-6 py-5 whitespace-nowrap text-base text-gray-800">
                                                            {expense.currency === 'USD' ? '$' : 'Bs. '}{expense.amount.toFixed(2)} {expense.currency}
                                                            <span className="text-sm text-gray-500 block">
                                                                {expense.currency === 'USD' ? ` (≈ ${(expense.amount * exchangeRate).toFixed(2)} VES)` : ` (≈ ${(expense.amount / exchangeRate).toFixed(2)} USD)`}
                                                            </span>
                                                        </td>
                                                        <td className="px-6 py-5 whitespace-nowrap text-right text-base font-medium">
                                                            <button
                                                                onClick={() => openConfirmModal('¿Estás seguro de que quieres eliminar este gasto?', () => handleDeleteExpense(expense.id))}
                                                                className="text-rose-600 hover:text-rose-800 ml-4 p-2"
                                                            >
                                                                Eliminar
                                                            </button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                    {sortedExpenses.length > ITEMS_PER_PAGE && ( // Solo muestra la paginación si hay más de una página
                                        <div className="pagination-container">
                                            <button
                                                onClick={() => setCurrentExpensesPage(prev => Math.max(prev - 1, 1))}
                                                disabled={currentExpensesPage === 1}
                                                className="pagination-button"
                                            >
                                                Anterior
                                            </button>
                                            {Array.from({ length: totalExpensesPages }, (_, i) => i + 1).map(page => (
                                                <button
                                                    key={page}
                                                    onClick={() => setCurrentExpensesPage(page)}
                                                    className={`pagination-button ${currentExpensesPage === page ? 'active' : ''}`}
                                                >
                                                    {page}
                                                </button>
                                            ))}
                                            <button
                                                onClick={() => setCurrentExpensesPage(prev => Math.min(prev + 1, totalExpensesPages))}
                                                disabled={currentExpensesPage === totalExpensesPages}
                                                className="pagination-button"
                                            >
                                                Siguiente
                                            </button>
                                        </div>
                                    )}
                                </>
                            )}
                        </div>

                        {/* Calculadora de Venta de Productos (General) */}
                        <div className="mb-16 p-9 bg-white rounded-3xl shadow-2xl border border-gray-100">
                            <h2 className="section-heading">
                                <svg xmlns="http://www.w3.org/2000/svg" width="52" height="52" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-calculator text-purple-600">
                                    <rect x="8" y="2" width="8" height="4" rx="1"></rect>
                                    <path d="M17 17v-2H7v2"></path>
                                    <path d="M17 10h-2V7H7v3"></path>
                                    <path d="M14 17h-4V14h4v3Z"></path>
                                    <rect x="3" y="6" width="18" height="16" rx="2"></rect>
                                </svg>
                                Calculadora de Precios de Productos
                            </h2>
                            <div className="flex flex-col sm:flex-row gap-4 mb-8">
                                <button
                                    onClick={() => {
                                        setCalculatorMode('calculateSellingPrice');
                                        // Clear inputs related to the other mode
                                        setDesiredSellingPriceInput('');
                                        setDesiredSellingPriceCurrency('USD');
                                        setCalculatedProfitPercentageResult(null);
                                    }}
                                    className={`flex-grow calculator-mode-button ${calculatorMode === 'calculateSellingPrice' ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-dollar-sign">
                                        <line x1="12" y1="1" x2="12" y2="23"></line>
                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                    </svg>
                                    Calcular Precio de Venta
                                </button>
                                <button
                                    onClick={() => {
                                        setCalculatorMode('calculateProfitPercentage');
                                        // Clear inputs related to the other mode
                                        setProfitPercentage('');
                                        setCalculatedSellingPricePerUnit(null);
                                    }}
                                    className={`flex-grow calculator-mode-button ${calculatorMode === 'calculateProfitPercentage' ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-percent">
                                        <line x1="19" y1="5" x2="5" y2="19"></line>
                                        <circle cx="6.5" cy="6.5" r="2.5"></circle>
                                        <circle cx="17.5" cy="17.5" r="2.5"></circle>
                                    </svg>
                                    Calcular % Ganancia
                                </button>
                            </div>

                            {calculatorMode === 'calculateSellingPrice' && (
                                <form onSubmit={handleCalculateSellingPrice} className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div>
                                        <label htmlFor="totalCostPrice" className="block text-gray-700 text-base font-bold mb-2">Costo Total de Compra (USD):</label>
                                        <input
                                            type="number"
                                            id="totalCostPrice"
                                            value={totalCostPrice}
                                            onChange={(e) => setTotalCostPrice(e.target.value)}
                                            placeholder="Ej: 150.00"
                                            min="0.01"
                                            step="0.01"
                                            className="w-full"
                                            required
                                        />
                                    </div>
                                    <div className="flex items-end space-x-4">
                                        <div className="flex-grow">
                                            <label htmlFor="purchaseQuantity" className="block text-gray-700 text-base font-bold mb-2">Cantidad Comprada:</label>
                                            <input
                                                type="number"
                                                id="purchaseQuantity"
                                                value={purchaseQuantity}
                                                onChange={(e) => setPurchaseQuantity(e.target.value)}
                                                placeholder="Ej: 10"
                                                min="0.01"
                                                step="0.01"
                                                className="w-full"
                                                required
                                            />
                                        </div>
                                        <div className="flex-shrink-0">
                                            <label htmlFor="purchaseMeasurementUnit" className="sr-only">Unidad de Medida</label>
                                            <select
                                                id="purchaseMeasurementUnit"
                                                value={purchaseMeasurementUnit}
                                                onChange={(e) => setPurchaseMeasurementUnit(e.target.value)}
                                                className="w-full py-3.5"
                                            >
                                                <option value="unidades">Unidades</option>
                                                <option value="gramos">Gramos</option>
                                                <option value="kilos">Kilos</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div>
                                        <label htmlFor="profitPercentage" className="block text-gray-700 text-base font-bold mb-2">Porcentaje de Ganancia Deseado (%):</label>
                                        <input
                                            type="number"
                                            id="profitPercentage"
                                            value={profitPercentage}
                                            onChange={(e) => setProfitPercentage(e.target.value)}
                                            placeholder="Ej: 30 (para 30%)"
                                            min="0"
                                            step="0.01"
                                            className="w-full"
                                            required
                                        />
                                    </div>
                                    <div className="md:col-span-2 mt-5">
                                        <button
                                            type="submit"
                                            className="w-full bg-purple-500 text-white py-4.5 px-8 rounded-xl hover:bg-purple-600 focus:outline-none focus:ring-4 focus:ring-purple-300 focus:ring-opacity-50 text-xl flex items-center justify-center"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-calculator mr-3">
                                                <rect x="8" y="2" width="8" height="4" rx="1"></rect>
                                                <path d="M17 17v-2H7v2"></path>
                                                <path d="M17 10h-2V7H7v3"></path>
                                                <path d="M14 17h-4V14h4v3Z"></path>
                                                <rect x="3" y="6" width="18" height="16" rx="2"></rect>
                                            </svg>
                                            Calcular Precios
                                        </button>
                                    </div>
                                </form>
                            )}

                            {calculatorMode === 'calculateProfitPercentage' && (
                                <form onSubmit={handleCalculateProfitPercentage} className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div>
                                        <label htmlFor="totalCostPriceProfit" className="block text-gray-700 text-base font-bold mb-2">Costo Total de Compra (USD):</label>
                                        <input
                                            type="number"
                                            id="totalCostPriceProfit"
                                            value={totalCostPrice}
                                            onChange={(e) => setTotalCostPrice(e.target.value)}
                                            placeholder="Ej: 150.00"
                                            min="0.01"
                                            step="0.01"
                                            className="w-full"
                                            required
                                        />
                                    </div>
                                    <div className="flex items-end space-x-4">
                                        <div className="flex-grow">
                                            <label htmlFor="purchaseQuantityProfit" className="block text-gray-700 text-base font-bold mb-2">Cantidad Comprada:</label>
                                            <input
                                                type="number"
                                                id="purchaseQuantityProfit"
                                                value={purchaseQuantity}
                                                onChange={(e) => setPurchaseQuantity(e.target.value)}
                                                placeholder="Ej: 10"
                                                min="0.01"
                                                step="0.01"
                                                className="w-full"
                                                required
                                            />
                                        </div>
                                        <div className="flex-shrink-0">
                                            <label htmlFor="purchaseMeasurementUnitProfit" className="sr-only">Unidad de Medida</label>
                                            <select
                                                id="purchaseMeasurementUnitProfit"
                                                value={purchaseMeasurementUnit}
                                                onChange={(e) => setPurchaseMeasurementUnit(e.target.value)}
                                                className="w-full py-3.5"
                                            >
                                                <option value="unidades">Unidades</option>
                                                <option value="gramos">Gramos</option>
                                                <option value="kilos">Kilos</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div className="flex items-end space-x-4">
                                        <div className="flex-grow">
                                            <label htmlFor="desiredSellingPriceInput" className="block text-gray-700 text-base font-bold mb-2">Precio de Venta Deseado por Unidad:</label>
                                            <input
                                                type="number"
                                                id="desiredSellingPriceInput"
                                                value={desiredSellingPriceInput}
                                                onChange={(e) => setDesiredSellingPriceInput(e.target.value)}
                                                placeholder="Ej: 18.00"
                                                min="0.01"
                                                step="0.01"
                                                className="w-full"
                                                required
                                            />
                                        </div>
                                        <div className="flex-shrink-0">
                                            <label htmlFor="desiredSellingPriceCurrency" className="sr-only">Moneda</label>
                                            <select
                                                id="desiredSellingPriceCurrency"
                                                value={desiredSellingPriceCurrency}
                                                onChange={(e) => setDesiredSellingPriceCurrency(e.target.value)}
                                                className="w-full py-3.5"
                                            >
                                                <option value="USD">USD</option>
                                                <option value="VES">VES</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div className="md:col-span-2 mt-5">
                                        <button
                                            type="submit"
                                            className="w-full bg-purple-500 text-white py-4.5 px-8 rounded-xl hover:bg-purple-600 focus:outline-none focus:ring-4 focus:ring-purple-300 focus:ring-opacity-50 text-xl flex items-center justify-center"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-calculator mr-3">
                                                <rect x="8" y="2" width="8" height="4" rx="1"></rect>
                                                <path d="M17 17v-2H7v2"></path>
                                                <path d="M17 10h-2V7H7v3"></path>
                                                <path d="M14 17h-4V14h4v3Z"></path>
                                                <rect x="3" y="6" width="18" height="16" rx="2"></rect>
                                            </svg>
                                            Calcular Porcentaje
                                        </button>
                                    </div>
                                </form>
                            )}

                            {(calculatedCostPerUnit !== null || calculatedSellingPricePerUnit !== null || calculatedProfitPercentageResult !== null) && (
                                <div className="mt-9 p-7 bg-purple-50 border border-purple-200 rounded-2xl shadow-inner text-center">
                                    <h3 className="text-xl font-semibold text-purple-800 mb-5">Resultados:</h3>
                                    {calculatedCostPerUnit !== null && (
                                        <p className="text-gray-700 text-lg">
                                            Costo por {purchaseMeasurementUnit === 'unidades' ? 'unidad' : purchaseMeasurementUnit === 'gramos' ? 'gramo' : 'kilo'}: <span className="font-bold text-purple-700">${calculatedCostPerUnit.toFixed(2)} USD</span>
                                        </p>
                                    )}
                                    {calculatorMode === 'calculateSellingPrice' && calculatedSellingPricePerUnit !== null && (
                                        <p className="text-gray-700 text-lg mt-3">
                                            Precio de Venta Sugerido por {purchaseMeasurementUnit === 'unidades' ? 'unidad' : purchaseMeasurementUnit === 'gramos' ? 'gramo' : 'kilo'}: <span className="font-bold text-xl text-purple-900">${calculatedSellingPricePerUnit.toFixed(2)} USD</span>
                                            <br />
                                            <span className="text-sm text-gray-500 block">≈ Bs. {(calculatedSellingPricePerUnit * exchangeRate).toFixed(2)} VES</span>
                                        </p>
                                    )}
                                    {calculatorMode === 'calculateProfitPercentage' && calculatedProfitPercentageResult !== null && (
                                        <p className="text-gray-700 text-lg mt-3">
                                            Porcentaje de Ganancia: <span className="font-bold text-xl text-purple-900">{calculatedProfitPercentageResult.toFixed(2)}%</span>
                                        </p>
                                    )}
                                </div>
                            )}
                        </div>


                        {/* Calculadora de Venta de Queso */}
                        <div className="mb-16 p-9 bg-white rounded-3xl shadow-2xl border border-gray-100">
                            <h2 className="section-heading">
                                <svg xmlns="http://www.w3.org/2000/svg" width="52" height="52" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-cheese text-gray-600">
                                    <path d="M12 21s-3-2-6-2-6 2-6 2V3s3 2 6 2 6-2 6-2v18Z"></path>
                                    <path d="M12 21s3-2 6-2 6 2 6 2V3s-3 2-6 2-6-2-6-2"></path>
                                    <path d="M15 13V8h-3v5"></path>
                                    <path d="M12 8v5h3"></path>
                                    <path d="M9 13V8h3v5"></path>
                                    <path d="M9 8v5h3"></path>
                                </svg>
                                Calculadora de Venta de Queso por Peso
                            </h2>
                            <form onSubmit={handleCalculateCheesePrice} className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div>
                                    <label htmlFor="cheeseWeightGrams" className="block text-gray-700 text-base font-bold mb-2">Peso del Queso (Gramos):</label>
                                    <input
                                        type="number"
                                        id="cheeseWeightGrams"
                                        value={cheeseWeightGrams}
                                        onChange={(e) => setCheeseWeightGrams(e.target.value)}
                                        placeholder="Ej: 860"
                                        min="0.01"
                                        step="0.01"
                                        className="w-full"
                                        required
                                    />
                                </div>
                                <div>
                                    <label htmlFor="cheesePricePerKiloUSD" className="block text-gray-700 text-base font-bold mb-2">Precio por Kilo (USD):</label>
                                    <input
                                        type="number"
                                        id="cheesePricePerKiloUSD"
                                        value={cheesePricePerKiloUSD}
                                        onChange={(e) => setCheesePricePerKiloUSD(e.target.value)}
                                        placeholder="Ej: 4.00"
                                        min="0.01"
                                        step="0.01"
                                        className="w-full"
                                        required
                                    />
                                </div>
                                <div className="md:col-span-2 mt-5">
                                    <button
                                        type="submit"
                                        className="w-full bg-green-400 text-white py-4.5 px-8 rounded-xl hover:bg-green-500 focus:outline-none focus:ring-4 focus:ring-green-300 focus:ring-opacity-50 text-xl flex items-center justify-center"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-calculator mr-3">
                                            <rect x="8" y="2" width="8" height="4" rx="1"></rect>
                                            <path d="M17 17v-2H7v2"></path>
                                            <path d="M17 10h-2V7H7v3"></path>
                                            <path d="M14 17h-4V14h4v3Z"></path>
                                            <rect x="3" y="6" width="18" height="16" rx="2"></rect>
                                        </svg>
                                        Calcular Precio del Queso
                                    </button>
                                </div>
                            </form>
                            {(calculatedCheesePriceUSD !== null && calculatedCheesePriceVES !== null) && (
                                <div className="mt-9 p-7 bg-green-50 border border-green-200 rounded-2xl shadow-inner text-center">
                                    <h3 className="text-xl font-semibold text-green-800 mb-5">Resultados:</h3>
                                    <p className="text-gray-700 text-lg">
                                        Total a Pagar en Divisas: <span className="font-bold text-green-700">${calculatedCheesePriceUSD.toFixed(2)} USD</span>
                                    </p>
                                    <p className="text-gray-700 text-lg mt-3">
                                        Total a Pagar en Bolívares: <span className="font-bold text-xl text-green-900">Bs. {calculatedCheesePriceVES.toFixed(2)} VES</span>
                                    </p>
                                </div>
                            )}
                        </div>
                        
                        {/* Sección: Venta de Queso a Crédito */}
                        <div className="mb-16 p-9 bg-white rounded-3xl shadow-2xl border border-gray-100">
                            <h2 className="section-heading">
                                <svg xmlns="http://www.w3.org/2000/svg" width="52" height="52" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-wallet text-gray-600">
                                    <path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h12a2 2 0 0 1 0 4H5a2 2 0 0 0 0 4h12a2 2 0 0 0 2-2v-3"></path>
                                    <path d="M2 20v-3h.01"></path>
                                </svg>
                                Venta de Queso a Crédito 🧀
                            </h2>
                            <p className="text-gray-700 text-base mb-6">
                                * Se utilizará el "Precio por Kilo (USD)" de la calculadora de queso para el cálculo.
                            </p>
                            <form onSubmit={handleAddCheeseCreditSale} className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div>
                                    <label htmlFor="creditCustomerName" className="block text-gray-700 text-base font-bold mb-2">Nombre del Cliente:</label>
                                    <input
                                        type="text"
                                        id="creditCustomerName"
                                        value={creditCustomerName}
                                        onChange={(e) => setCreditCustomerName(e.target.value)}
                                        placeholder="Ej: Juan Pérez"
                                        className="w-full"
                                        required
                                    />
                                </div>
                                <div>
                                    <label htmlFor="creditCheeseWeightGrams" className="block text-gray-700 text-base font-bold mb-2">Peso (Gramos):</label>
                                    <input
                                        type="number"
                                        id="creditCheeseWeightGrams"
                                        value={creditCheeseWeightGrams}
                                        onChange={(e) => setCreditCheeseWeightGrams(e.target.value)}
                                        placeholder="Ej: 655"
                                        min="0.01"
                                        step="0.01"
                                        className="w-full"
                                        required
                                    />
                                </div>
                                <div className="md:col-span-2 mt-5">
                                    <button
                                        type="submit"
                                        className="w-full bg-blue-400 text-white py-4.5 px-8 rounded-xl hover:bg-blue-500 focus:outline-none focus:ring-4 focus:ring-blue-300 focus:ring-opacity-50 text-xl flex items-center justify-center"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-plus mr-3">
                                            <line x1="12" y1="5" x2="12" y2="19"></line>
                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                        </svg>
                                        Registrar Crédito
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        {/* Historial de Venta de Queso a Crédito */}
                        <div className="mb-16 p-9 bg-white rounded-3xl shadow-2xl border border-gray-100">
                            <h2 className="section-heading">
                                <svg xmlns="http://www.w3.org/2000/svg" width="52" height="52" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-clipboard-list text-gray-600">
                                    <rect x="9" y="7" width="10" height="4" rx="1"></rect>
                                    <path d="M15 3h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h2"></path>
                                    <path d="M8 7H5"></path>
                                    <path d="M8 12H5"></path>
                                    <path d="M12 17H5"></path>
                                </svg>
                                Historial de Venta de Queso a Crédito
                            </h2>
                            {paginatedCheeseCreditSales.length === 0 ? (
                                <p className="text-gray-600 text-center py-7 text-lg">No hay registros de crédito de queso aún.</p>
                            ) : (
                                <>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full">
                                            <thead>
                                                <tr>
                                                    <th onClick={() => handleCheeseCreditSort('date')} className="px-6 py-4 text-left">
                                                        Fecha {cheeseCreditSortColumn === 'date' && (cheeseCreditSortDirection === 'asc' ? '↑' : '↓')}
                                                    </th>
                                                    <th onClick={() => handleCheeseCreditSort('customerName')} className="px-6 py-4 text-left">
                                                        Cliente {cheeseCreditSortColumn === 'customerName' && (cheeseCreditSortDirection === 'asc' ? '↑' : '↓')}
                                                    </th>
                                                    <th className="px-6 py-4 text-left">Peso (g)</th>
                                                    <th onClick={() => handleCheeseCreditSort('totalUSD')} className="px-6 py-4 text-left">
                                                        Monto Adeudado {cheeseCreditSortColumn === 'totalUSD' && (cheeseCreditSortDirection === 'asc' ? '↑' : '↓')}
                                                    </th>
                                                    <th className="px-6 py-4 text-left">Acciones</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {paginatedCheeseCreditSales.map((sale) => (
                                                    <tr key={sale.id}>
                                                        <td className="px-6 py-5 whitespace-nowrap text-base text-gray-800">{sale.date}</td>
                                                        <td className="px-6 py-5 whitespace-nowrap text-base text-gray-800">{sale.customerName}</td>
                                                        <td className="px-6 py-5 whitespace-nowrap text-base text-gray-800">{sale.weightGrams} g</td>
                                                        <td className="px-6 py-5 whitespace-nowrap text-base text-gray-800">
                                                            ${sale.totalUSD.toFixed(2)} USD
                                                            <span className="text-sm text-gray-500 block">
                                                                ≈ Bs. {(sale.totalUSD * exchangeRate).toFixed(2)} VES
                                                            </span>
                                                        </td>
                                                        <td className="px-6 py-5 whitespace-nowrap text-right text-base font-medium">
                                                            <button
                                                                onClick={() => openConfirmModal('¿Estás seguro de que quieres eliminar este registro de fiado?', () => handleDeleteCheeseCreditSale(sale.id))}
                                                                className="text-rose-600 hover:text-rose-800 ml-4 p-2"
                                                            >
                                                                Eliminar
                                                            </button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                    {sortedCheeseCreditSales.length > ITEMS_PER_PAGE && ( // Solo muestra la paginación si hay más de una página
                                        <div className="pagination-container">
                                            <button
                                                onClick={() => setCurrentCheeseCreditPage(prev => Math.max(prev - 1, 1))}
                                                disabled={currentCheeseCreditPage === 1}
                                                className="pagination-button"
                                            >
                                                Anterior
                                            </button>
                                            {Array.from({ length: totalCheeseCreditPages }, (_, i) => i + 1).map(page => (
                                                <button
                                                    key={page}
                                                    onClick={() => setCurrentCheeseCreditPage(page)}
                                                    className={`pagination-button ${currentCheeseCreditPage === page ? 'active' : ''}`}
                                                >
                                                    {page}
                                                </button>
                                            ))}
                                            <button
                                                onClick={() => setCurrentCheeseCreditPage(prev => Math.min(prev + 1, totalCheeseCreditPages))}
                                                disabled={currentCheeseCreditPage === totalCheeseCreditPages}
                                                className="pagination-button"
                                            >
                                                Siguiente
                                            </button>
                                        </div>
                                    )}
                                </>
                            )}
                        </div>
                    </div>
                </div>
            );
        };
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
